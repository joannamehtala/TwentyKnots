<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script src="//use.typekit.net/pwf2wwo.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
     <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,700,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="kartta_style.css">
    <script src="infobubble.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1pEM1hGTESl2YoesdrVnhuWfCdBsvJ78&sensor=false&libraries=places,drawing,geometry">
    </script>
    <script type="text/javascript">
            
    /********  GOOGLE MAPS SETIT ALKAA ********/    
     
    /* meidän pääkartta */    
    var map;
    var retket = [];
    
    function initialize() {
        var mapOptions = {
          center: { lat: 60.13176, lng: 24.793814},
          zoom: 12
        
        };
        
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        
        
        
        
        //alustetaan kaikki retket
        var j = 0;
        while(j < retket.length){
            var retki = retket[j];
            retki.ikonit[0].setMap(map);
            
            google.maps.event.addListener(retki.ikonit[0], 'click', function() {
                    
                var klikattuRetki = retket[this.retkenNumero];
                
                //jos retki ei oo vielä auki
                if(klikattuRetki.onkoAvattu == false) {
                    console.log("avataan");
                    klikattuRetki.piirraReitti(map);

                    var i = 0;
                    while(i < klikattuRetki.ikonit.length){
                        klikattuRetki.ikonit[i].setMap(map);
                        i++;
                    } 
                    
                    klikattuRetki.onkoAvattu = true;
                } else {
                    
                    console.log('suljetaan');
                    // otetaan reitti pois
                    klikattuRetki.suljeReitti();
                    // otetaan ikonit pois
                    klikattuRetki.poistaIkonit();
                    klikattuRetki.onkoAvattu = false;
                
                }
            });

            google.maps.event.addListener(retki.ikonit[1], 'click', function() {
                    console.log(this.retkenNumero);
                    var klikattuRetki1 = retket[this.retkenNumero];
                    klikattuRetki1.tiedot.avaaInfoWindow(map, klikattuRetki1.ikonit[1]);
            });
            
            google.maps.event.addListener(retki.ikonit[2], 'click', function() {
                    var klikattuRetki2 = retket[this.retkenNumero];
                    klikattuRetki2.saa.avaaSaaWindow(map, klikattuRetki2.ikonit[2]);
            });

            google.maps.event.addListener(retki.ikonit[3], 'click', function() {
                    var klikattuRetki3 = retket[this.retkenNumero];
                    klikattuRetki3.kalenteri.avaaKalenteriWindow(map, klikattuRetki3.ikonit[3]);
            });
            
            google.maps.event.addListener(retki.ikonit[4], 'click', function() {
                    var klikattuRetki4 = retket[this.retkenNumero];    
                    klikattuRetki4.kuva.avaaKuvaWindow(map, klikattuRetki4.ikonit[4]);
            });


            j++;
        };
    }
        
    
        
    google.maps.event.addDomListener(window, 'load', initialize);
        
        
        
        
        
        
    /********************************************************/
    /****************** luodaan retki olio ******************/
    /********************************************************/
        
    function retki(koordinaatit, tiedot, saa, kalenteri, kuva, zoomLevel){
        
        /* attribuutit */
        this.koordinaatit = koordinaatit;
        this.tiedot = tiedot;
        this.saa = saa;
        this.kalenteri = kalenteri;
        this.kuva = kuva;
        this.zoomLevel = zoomLevel;
        this.ikonit = [];
        this.ikonilisa = 0.005; 
        this.latAvg;
        this.reitti2;
        this.onkoAvattu = false;
        
        /* lasketaan reittipisteiden latitude keskiarvo  */
        var summa = 0;
        for( var i = 0; i < this.koordinaatit.length; i++ ){
            summa += this.koordinaatit[i].lat();
            console.log(summa);
        }
        this.latAvg = summa/this.koordinaatit.length;
        console.log(this.latAvg)
        
        if( this.latAvg > this.koordinaatit[0].lat() ){
            this.ikonilisa = -0.003;
        }
        
        /* funktioita */
        this.muutaZoom = function(kartta) {
          kartta.setZoom(this.zoomLevel);
        }
        
        this.muutaCenter = function(kartta){
            kartta.setCenter(this.koordinaatit[0]);
        }
    
        this.piirraReitti = function(kartta) {
           
            var x = 0;
            var departure = this.koordinaatit[x];
            var arrival = this.koordinaatit[x+1];
            var reitti = new google.maps.Polyline({
                path: [departure, departure],
                strokeColor: "#335A9F",
                strokeOpacity: 1,
                strokeWeight: 6,
                geodesic: true, //set to false if you want straight line instead of arc
                map: kartta,
            });
               
            var step = 0;
            var numSteps = 50; //Change this to set animation resolution
            var timePerStep = 1; //Change this to alter animation speed
            var interval;
            var path = [];
            var ensimmainenKerta = true;
            
            function alustaAnimaatio(){
                
                departure = koordinaatit[x];
                arrival = koordinaatit[x+1];
                step = 0;
                if(x < koordinaatit.length-1){
                    interval = setInterval(animoiReitti, timePerStep);
                }
            }
                
            function animoiReitti(){
                   
                   step += 1;
                   if (step > numSteps) {  
                       clearInterval(interval);
                       x++;
                       alustaAnimaatio();
                   } else { 
                       var are_we_there_yet = google.maps.geometry.spherical.interpolate(departure,arrival,step/numSteps);
                       if(ensimmainenKerta){
                         path.push(are_we_there_yet);
                         path.push(departure);
                         ensimmainenKerta = false;
                       } else {
                         path.push(departure);
                         path[path.length-1] = are_we_there_yet;
                       }
                       reitti.setPath(path);       
                   }       
            }
            alustaAnimaatio();
            this.muutaZoom(kartta);
            this.muutaCenter(kartta);
            this.reitti2 = reitti;
        }
        
        this.suljeReitti = function(){
          console.log(this.reitti2);
          this.reitti2.setMap(null);
          console.log("helloo");
        }   
        
        this.poistaIkonit = function(){
            var i = 1;
            while(i < this.ikonit.length){
                this.ikonit[i].setMap(null);
                i++;
            } 
        }
  
    }

        

        
 /********************************************************/
 /****************** luodaan tiedot olio *****************/
 /********************************************************/        
        
        
    function tiedot(nimi, kuvaus, kesto, hinta, tarvikkeet, taso, lahto, sis, huom){
        this.nimi = nimi;
        this.kuvaus = kuvaus;
        this.kesto = kesto;
        this.hinta = hinta;
        this.tarvikkeet = tarvikkeet;
        this.taso = taso;
        this.lahto = lahto;
        this.sis = sis;
        this.huom = huom;

        this.avaaInfoWindow = function(map, marker){
            var info = this.annaHTMLMuodossa(); 
            var infowindow = new InfoBubble({
                  maxWidth: 500,
                  maxHeight: 600,
                  map: map,
                  backgroundColor: 'rgba(255,255,255,0.7)',
                  borderRadius: 3,
                  disableAnimation: true,
                  borderColor: 'rgba(255,255,255,0.7)',
                  shadowStyle: 0,
                  content: info
            });

            infowindow.open(map, marker);
        }

        this.annaHTMLMuodossa = function(){
            var htmlMuodossa = '<div class="infobox">'+
            '</div>'+
            '<h1>'+this.nimi+'</h1>'+
            '<div class="content">'+
            '<p>'+this.kuvaus+'</p>'+
            '<div class="wrapper left">'+
            '<p>'+this.kesto+'</p>'+
            '<p>'+this.tarvikkeet+'</p>'+
            '<p>'+this.taso+'</p>'+
            '<p>'+this.lahto+'</p>'+
            '</div>'+
            '<div class="wrapper right">'+
            '<p>'+this.hinta+'</p>'+
            '<p>'+this.sis+'</p>'+
            '<p>'+this.huom+'</p>'+
            '</div>'+
            '</div>';

            return htmlMuodossa;
        }
    }

 /********************************************************/
 /****************** luodaan kuva olio *******************/
 /********************************************************/            
   
        
    function kuva(kuvatiedosto){
        this.kuvatiedosto = kuvatiedosto;

        this.avaaKuvaWindow = function(map, marker){
            var kuvaWindow = new InfoBubble({
                  map: map,
                  backgroundColor: 'rgba(255,255,255,0.7)',
                  borderRadius: 3,
                  borderColor: 'rgba(255,255,255,0.7)',
                  shadowStyle: 0,
                  disableAnimation: true,
                  content: '<div id="content" class="infobox">'+
                            '<div id="siteNotice">'+
                            '</div>'+
                            '<div id="bodyContent">'+
                            '<img src="'+this.kuvatiedosto+'" width="500">'+
                            '</div>'+
                            '</div>'
                            });

            kuvaWindow.open(map, marker);
        }
    }

 /********************************************************/
 /****************** luodaan saa olio *******************/
 /********************************************************/


    function saa(otsikko, kuvaus){
        this.otsikko = otsikko;
        this.kuvaus = kuvaus;

        this.avaaSaaWindow = function(map, marker){
            var saaWindow = new InfoBubble({
                  map: map,
                  backgroundColor: 'rgba(255,255,255,0.7)',
                  borderRadius: 3,
                  borderColor: 'rgba(255,255,255,0.7)',
                  shadowStyle: 0,
                  disableAnimation: true,
                  content: '<div id="content" class="infobox">'+
                           '<div id="siteNotice">'+
                           '</div>'+
                           '<h1 id="firstHeading" class="firstHeading">'+this.otsikko+'</h1>'+
                           '<div id="bodyContent">'+
                           '<p>'+this.kuvaus+'</p>'+
                           '</div>'+
                           '</div>'
                          });

            saaWindow.open(map, marker);
        }
    }

 /********************************************************/
 /****************** luodaan kalenteri olio *******************/
 /********************************************************/


    function kalenteri(otsikko, kuvaus){
        this.otsikko = otsikko;
        this.kuvaus = kuvaus;

        this.avaaKalenteriWindow = function(map, marker){
            var kalenteriWindow = new InfoBubble({
                  map: map,
                  maxWidth: 350,
                  backgroundColor: 'rgba(255,255,255,0.7)',
                  borderRadius: 3,
                  borderColor: 'rgba(255,255,255,0.7)',
                  shadowStyle: 0,
                  disableAnimation: true,
                  content: '<div id="content" class="infobox">'+
                           '<div id="siteNotice">'+
                           '</div>'+
                           '<h1 id="firstHeading" class="firstHeading">'+this.otsikko+'</h1>'+
                           '<div id="bodyContent">'+
                           '<p>'+this.kuvaus+'</p>'+
                           '</div>'+
                           '</div>'
                          });

            kalenteriWindow.open(map, marker);
        }

    }

        
 /* luodaan google maps kuvaikonit */        
        
    var image = new google.maps.MarkerImage("images/karttaicons/kamera.png", null, null, null, new      google.maps.Size(40, 40));
    var image2 = new google.maps.MarkerImage("images/karttaicons/markkeri.png", null, null, null, new      google.maps.Size(54, 84));
    var imageinfo = new google.maps.MarkerImage("images/karttaicons/info.png", null, null, null, new      google.maps.Size(40, 40));
    var imagesaa = new google.maps.MarkerImage("images/karttaicons/saa.png", null, null, null, new      google.maps.Size(40, 40));
    var imagekalenteri = new google.maps.MarkerImage("images/karttaicons/kalenteri.png", null, null, null, new      google.maps.Size(40, 40));        
        

        
        
        
        
        
 /********************************************************/
 /****************** luodaan retkiä **********************/
 /********************************************************/    
        
    /* luodaan retkiä */ 
    var nimi = "Suvisaaristo";
    var kuvaus = "Tällä retkellä kierrämme kauniin Suinon saaren. Monipuolisen melontareitin varrella pääsee ihastelemaan saaren kaunista luontoa, upeita näkymiä aavalle merelle sekä suloisia saaristohuviloita. Pysähdymme retken aikana luodolle nauttimaan kuumaa juotavaa ja retkieväitä. Jokainen osallistuja saa paikanpäältä lämpimän märkäpuvun ja tossut.";
    var kesto = '<b>'+"Kesto:"+'</b>'+" n. 3 tuntia (on mahdollista että retken kesto menee yli 3 tunnin).";
    var hinta = '<b>'+"Hinta:"+'</b>'+" 50€ (Kausikorttilaiset: 25€ ja sarjakorttilaiset: 3 * SUP-vuokra)"; 
    var tarvikkeet = '<b>'+"Mitä tarvitsen:"+'</b>'+" Kuoritakki/tuulitakki, pipo, ohuet hanskat, pyyhe, kuivat vaatteet, vesipullo, ja retkievästä.";
    var taso = '<b>'+"Retken taso:"+'</b>'+" Reitin taso on helppo ja melomme rauhallista tahtia osallistujien toiveiden mukaan. Retkelle osallistujilta vaadimme kuitenkin aikaisempaa SUP-melontakokemusta.";
    var lahto = '<b>'+"Lähtöpaikka:"+'</b>'+" Svinön Uimaranta. Suvisaarentie 9, Espoo. Tapaamme suurella hiekkaparkkipaikalla tien vieressä. Paikalle pääsee linja-autolla 145 sekä omalla autolla.";
    var sis = '<b>'+"Hintaan sis:"+'</b>'+" Kova sup-melontalauta, mela, pelastusliivit, märkäpuku ja tossut.";
    var huom = '<b>'+"Muuta huomioitavaa:"+'</b>'+" Retkillämme on säävaraus. Ilmoitamme edeltävällä viikolla mikäli retki joudutaan perumaan. Retken toteutumiseen tarvitsemme turvalliset sääolosuhteet.";
    var tiedotSuvisaaristo = new tiedot(nimi, kuvaus, kesto, hinta, tarvikkeet, taso, lahto, sis, huom);
    var saaSuvisaaristo = new saa("Suvisaariston sää", "Sääpalvelun tarjoaa Foreca");
    var kalenteriSuvisaaristo = new kalenteri("Tulevat retket Suvisaaristoon", "12.04.2015 klo 12:00-15:00");
    var kuva1 = new kuva("images/supyoga.jpg");

        
    var suvisaaristo = new retki([
            new google.maps.LatLng( 60.12787051824118, 24.691343307495117),
            new google.maps.LatLng( 60.127357522076636, 24.694690704345703),
            new google.maps.LatLng( 60.1282125112417, 24.697608947753906),
            new google.maps.LatLng( 60.12979418263997, 24.701128005981445),
            new google.maps.LatLng( 60.133299237518216, 24.70198631286621),
            new google.maps.LatLng( 60.13547902235875, 24.71022605895996),
            new google.maps.LatLng( 60.136376538846946, 24.72696304321289),
            new google.maps.LatLng( 60.13428229561916, 24.73125457763672),
            new google.maps.LatLng( 60.13278632597922, 24.731769561767578),
            new google.maps.LatLng( 60.13210243148941, 24.735631942749023),
            new google.maps.LatLng( 60.12983692946053, 24.73374366760254),
            new google.maps.LatLng( 60.12757127145036, 24.728593826293945),
            new google.maps.LatLng( 60.12513444629072, 24.730310440063477),
            new google.maps.LatLng( 60.12308224305198, 24.72970962524414),
            new google.maps.LatLng( 60.12252641598807, 24.726791381835938),
            new google.maps.LatLng( 60.123253264875714, 24.724044799804688),
            new google.maps.LatLng( 60.122611928454944, 24.717693328857422),
            new google.maps.LatLng( 60.12205609344919, 24.713315963745117),
            new google.maps.LatLng( 60.12329602019279, 24.71099853515625),
            new google.maps.LatLng( 60.121799551050096, 24.699668884277344),
            new google.maps.LatLng( 60.12539096269888, 24.69426155090332),
            new google.maps.LatLng( 60.127015520191065, 24.68979835510254),
      ], tiedotSuvisaaristo, saaSuvisaaristo, kalenteriSuvisaaristo, kuva1,  13);
        
    retket.push(suvisaaristo);
                
     
        
     /* luodaan retkiä */ 
    var nimi = "Käärmeluodot";
    var kuvaus = "Tällä retkellä kierrämme kauniin Suinon saaren. Monipuolisen melontareitin varrella pääsee ihastelemaan saaren kaunista luontoa, upeita näkymiä aavalle merelle sekä suloisia saaristohuviloita. Pysähdymme retken aikana luodolle nauttimaan kuumaa juotavaa ja retkieväitä. Jokainen osallistuja saa paikanpäältä lämpimän märkäpuvun ja tossut.";
    var kesto = '<b>'+"Kesto:"+'</b>'+" n. 3 tuntia (on mahdollista että retken kesto menee yli 3 tunnin).";
    var hinta = '<b>'+"Hinta:"+'</b>'+" 50€ (Kausikorttilaiset: 25€ ja sarjakorttilaiset: 3 * SUP-vuokra)"; 
    var tarvikkeet = '<b>'+"Mitä tarvitsen:"+'</b>'+" Kuoritakki/tuulitakki, pipo, ohuet hanskat, pyyhe, kuivat vaatteet, vesipullo, ja retkievästä.";
    var taso = '<b>'+"Retken taso:"+'</b>'+" Reitin taso on helppo ja melomme rauhallista tahtia osallistujien toiveiden mukaan. Retkelle osallistujilta vaadimme kuitenkin aikaisempaa SUP-melontakokemusta.";
    var lahto = '<b>'+"Lähtöpaikka:"+'</b>'+" Svinön Uimaranta. Suvisaarentie 9, Espoo. Tapaamme suurella hiekkaparkkipaikalla tien vieressä. Paikalle pääsee linja-autolla 145 sekä omalla autolla.";
    var sis = '<b>'+"Hintaan sis:"+'</b>'+" Kova sup-melontalauta, mela, pelastusliivit, märkäpuku ja tossut.";
    var huom = '<b>'+"Muuta huomioitavaa:"+'</b>'+" Retkillämme on säävaraus. Ilmoitamme edeltävällä viikolla mikäli retki joudutaan perumaan. Retken toteutumiseen tarvitsemme turvalliset sääolosuhteet.";
    var tiedotKaarmeluodot = new tiedot(nimi, kuvaus, kesto, hinta, tarvikkeet, taso, lahto, sis, huom);
    var saaKaarmeluodot = new saa("Suvisaariston sää", "Sääpalvelun tarjoaa Foreca");
    var kalenteriKaarmeluodot = new kalenteri("Tulevat retket Suvisaaristoon", "12.04.2015 klo 12:00-15:00");
    var kuva1 = new kuva("images/supyoga.jpg");    
    var kaarmeluodot = new retki([    
    
        new google.maps.LatLng(60.15459937355298, 24.872617721557617),
        new google.maps.LatLng( 60.15171601014133, 24.86952781677246),
        new google.maps.LatLng( 60.15069075331861, 24.86309051513672),
        new google.maps.LatLng( 60.15069075331861, 24.85558032989502),
        new google.maps.LatLng( 60.15113930711245, 24.845237731933594),
        new google.maps.LatLng( 60.15090435112648, 24.840989112854004),
        new google.maps.LatLng( 60.15009267207424, 24.83905792236328),
        new google.maps.LatLng( 60.14896055993272, 24.8386287689209),
        new google.maps.LatLng( 60.14370534038359, 24.837899208068848),
        new google.maps.LatLng( 60.142637103631955, 24.839229583740234),
        new google.maps.LatLng( 60.14250891289015, 24.84236240386963),
        new google.maps.LatLng( 60.14441035763323, 24.844379425048828),
        new google.maps.LatLng( 60.146098064803944, 24.84661102294922),
        new google.maps.LatLng( 60.14579898377164, 24.848756790161133),
        new google.maps.LatLng( 60.14564944223549, 24.85407829284668),
        new google.maps.LatLng( 60.14765751468975, 24.863948822021484),
        new google.maps.LatLng( 60.149238251424435, 24.872102737426758),
        new google.maps.LatLng( 60.15043443411743, 24.873390197753906),
        new google.maps.LatLng( 60.15342470046727, 24.873647689819336 ),

    ], tiedotKaarmeluodot, saaKaarmeluodot, kalenteriKaarmeluodot, kuva1, 13);
        
    retket.push(kaarmeluodot);
        
    
        
        
    
        
        
        
    //alustetaan kaikki retket
    var k = 0;
    while(k < retket.length){
        var retki = retket[k]
    
            /* luodaan retken ikoneita */ 
        
            var aloitusikoni = new google.maps.Marker({
                  position: { lat: retki.koordinaatit[0].lat(), lng: retki.koordinaatit[0].lng()},
                  map: map,
                  icon: image2,
                  retkenNumero: k
            }); 
        
            var info = new google.maps.Marker({
                          position: { lat: retki.koordinaatit[0].lat()+retki.ikonilisa, lng: retki.koordinaatit[0].lng()+0.003 },
                          map: map,
                          icon: imageinfo,
                          retkenNumero: k
            })

            var saa = new google.maps.Marker({
                          position: { lat: retki.koordinaatit[0].lat()+retki.ikonilisa, lng: retki.koordinaatit[0].lng()+0.008 },
                          map: map,
                          icon: imagesaa,
                          retkenNumero: k
            })

            var kalenteri = new google.maps.Marker({
                          position: { lat: retki.koordinaatit[0].lat()+retki.ikonilisa, lng: retki.koordinaatit[0].lng()+0.013 },
                          map: map,
                          icon: imagekalenteri,
                          retkenNumero: k
            })

            var kuvat = new google.maps.Marker({
                          position: { lat: retki.koordinaatit[0].lat()+retki.ikonilisa, lng: retki.koordinaatit[0].lng()+0.018 },
                          map: map,
                          icon: image,
                          retkenNumero: k
            });


            /* lisätään retken ikonit listaan */
        
            retki.ikonit.push(aloitusikoni);
            retki.ikonit.push(info);
            retki.ikonit.push(saa);
            retki.ikonit.push(kalenteri);
            retki.ikonit.push(kuvat);
        
        k++;
    
    }
        
        
        
        
    </script>
  </head>
  <body>
<div id="map-canvas"></div>
  </body>
</html>